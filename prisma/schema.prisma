// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// Enums for status fields
enum Role {
  USER
  ADMIN
}
enum StockStatus {
  IN_STOCK
  OUT_OF_STOCK
}
enum OrderStatus {
  PENDING
  PROCESSING
  SHIPPED
  COMPLETED
  FAILED
}

enum LeadStatus {
  SUBMITTED
  CONTACTED
  CLOSED
}

enum ProductCategory {
  BAR
  COIN
  JEWELRY
}

// --- CORE MODELS ---
model User {
  id          String   @id @default(uuid())
  email       String   @unique
  fullName    String
  country     String
  phoneNumber String
  password    String
  role        Role     @default(USER)
  orders      Order[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Product {
  id            String          @id @default(uuid())
  sku           String          @unique
  name          String
  description   String?         @db.Text
  price         Decimal         @db.Decimal(10, 2)
  weight        String
  karat         String
  category      ProductCategory
  imageUrl      String
  vendorName    String
  stockStatus   StockStatus     @default(IN_STOCK)
  isActive      Boolean         @default(true)
  orderItems    OrderItem[]
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
}

model Order {
  id                    String      @id @default(uuid())
  displayId             Int         @unique @default(autoincrement()) // User-friendly sequential ID
  userId                String
  user                  User        @relation(fields: [userId], references: [id])
  totalAmount           Decimal     @db.Decimal(10, 2)
  currency              String      @default("USD")
  shippingAddressJson   Json
  status                OrderStatus @default(PENDING)
  stripePaymentIntentId String?     @unique
  items                 OrderItem[]
  createdAt             DateTime    @default(now())
  updatedAt             DateTime    @updatedAt
}

model OrderItem {
  id              String  @id @default(uuid())
  orderId         String
  order           Order   @relation(fields: [orderId], references: [id])
  productId       String
  product         Product @relation(fields: [productId], references: [id])
  quantity        Int
  priceAtPurchase Decimal @db.Decimal(10, 2)
  @@unique([orderId, productId])
}

model SecondHandLead {
  id              String     @id @default(uuid())
  fullName        String
  email           String
  phoneNumber     String
  country         String
  city            String
  itemType        String
  estimatedWeight String
  estimatedKarat  String
  estimatedValue  Decimal?   @db.Decimal(10, 2)
  photoUrls       Json       @default("[]")
  status          LeadStatus @default(SUBMITTED)
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
}

// --- LIVE GOLD PRICE ---
model GoldPrice {
  id            String    @id
  currentPrice  Decimal   @db.Decimal(10, 3)
  previousPrice Decimal   @db.Decimal(10, 3)
  updatedAt     DateTime  @updatedAt
}

model Karat {
  id     Int     @id @default(autoincrement())
  name   String  @unique // e.g., "24K", "22K"
  purity Decimal @db.Decimal(8, 4) // e.g., 0.9999
}
